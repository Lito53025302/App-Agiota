<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="theme-color" content="#007bff">
  <link rel="stylesheet" href="styles.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema Fácil</title>
</head>
<body>

<!-- Tela de Login por Token -->
<div id="loginScreen" style="text-align:center;padding:40px;">
  <h2>Acesso ao Sistema</h2>
  <input type="password" id="tokenInput" placeholder="Digite seu token" style="padding:10px;width:60%;margin-bottom:12px;border-radius:6px;border:1px solid #ccc;">
  <br>
  <button onclick="checkToken()" style="padding:10px 20px;border:none;border-radius:6px;background:#007bff;color:white;font-weight:bold;">Entrar</button>
</div>

<!-- Cabeçalho com nome do sistema -->
<h1>Sistema Fácil</h1>

<div class="container">

  <!-- Tela Principal -->
  <div id="homeScreen" style="display:none;">
    <!-- Dashboard Financeiro -->
    <div id="dashboard" class="dashboard compact-dashboard">
      <div class="dashboard-item">
        <div class="dashboard-label">Total Emprestado</div>
        <div class="dashboard-value" id="totalLoaned">R$ 0,00</div>
      </div>
      <div class="dashboard-item">
        <div class="dashboard-label">Total Recebido</div>
        <div class="dashboard-value" id="totalReceived">R$ 0,00</div>
      </div>
      <div class="dashboard-item">
        <div class="dashboard-label">Lucro em Juros</div>
        <div class="dashboard-value" id="totalProfit">R$ 0,00</div>
      </div>
      <div class="dashboard-item">
        <div class="dashboard-label">Valor a Receber</div>
        <div class="dashboard-value" id="totalToReceive">R$ 0,00</div>
      </div>
    </div>
    <!-- Fim Dashboard -->

    <button class="primary" onclick="openRegister()">Cadastrar Novo Cliente</button>
    <button class="secondary" onclick="showAllClients()">Mostrar Todos os Clientes</button>

    <div class="search-area">
      <input type="search" id="clientSearch" placeholder="Digite o nome do cliente..." aria-label="Buscar cliente" />
      <button class="secondary" onclick="searchClient()">Buscar Cliente</button>
    </div>

    <div class="client-list">
      <h2>Mensalidades Vencendo nos Próximos 5 Dias</h2>
      <ul id="duePayments">
        <!-- Será populada por JS -->
      </ul>
    </div>
  </div>

  <!-- Tela de Registro de Novo Cliente -->
  <div id="registerForm" class="hidden" aria-label="Formulário Cadastro Cliente">
    <h2>Cadastrar Novo Cliente</h2>
    <form id="formRegister" onsubmit="return false;">
      <input type="text" id="name" required placeholder="Nome completo" autocomplete="off" />
      <input type="tel" id="phone" pattern="[0-9\s\-\+\(\)]{8,15}" placeholder="Telefone" autocomplete="off" />
      <input type="text" id="cpf" placeholder="CPF" autocomplete="off" />
      <input type="text" id="rg" placeholder="RG" autocomplete="off" />
      <input type="text" id="address" placeholder="Endereço" autocomplete="off" />
      <input type="text" id="cep" placeholder="CEP" autocomplete="off" />
      <input type="file" id="photo" accept="image/*" onchange="updatePhotoPreview(event)" />
      <img id="photoPreview" alt="Preview da foto do cliente" class="hidden" />
      <button type="button" class="primary" onclick="registerClient()">Salvar Cliente</button>
      <button type="button" class="secondary" onclick="closeRegister()">Cancelar</button>
    </form>
  </div>

  <!-- Tela do Perfil do Cliente -->
  <div id="clientProfile" class="hidden" aria-label="Perfil do Cliente">
    <h2>Perfil do Cliente</h2>
    <div class="profile-flex">
      <img id="clientPhoto" src="" alt="Foto do Cliente" />
      <div id="clientData"></div>
    </div>

    <div id="loanSection" aria-label="Adicionar empréstimo">
      <input type="number" id="loanAmount" placeholder="Valor do Empréstimo (R$)" min="0" step="0.01" aria-label="Valor do empréstimo" />
      <input type="number" id="interestRate" placeholder="Porcentagem de Juros (%)" min="0" max="100" step="0.01" aria-label="Porcentagem de juros" />
      <button onclick="addLoan()" class="primary" aria-label="Adicionar empréstimo">Adicionar</button>
    </div>

    <div id="loanInfo"></div>

    <div id="profileActions">
      <button onclick="editProfile()" class="secondary btn-margin">Editar Perfil</button>
      <button onclick="chargeDebt()" class="secondary">Cobrar</button>
      <button onclick="showPayments()" class="secondary btn-margin">Visualizar Pagamentos</button>
      <button onclick="confirmDeleteClient(currentClient.id)" class="secondary btn-margin">Excluir Cliente</button>
    </div>

    <div id="paymentSection" class="hidden section-margin">
      <input type="number" id="payAmount" placeholder="Insira valor pago (R$)" min="0" step="0.01" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius:6px; border: 1px solid #ccc;" />
      <button onclick="confirmPayment()" class="primary btn-fullwidth">Confirmar Pagamento</button>
    </div>

    <div id="reminderMessage" class="hidden"></div>

    <button onclick="backToHome()" class="secondary btn-margin-lg">Voltar</button>
  </div>

</div>

<!-- Modal para visualizar pagamentos -->
<div id="paymentModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Pagamentos</h3>
    <ul id="paymentList"></ul>
  </div>
</div>

<!-- Modal para recibo de cobrança -->
<div id="receiptModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeReceiptModal()">&times;</span>
    <h3>Recibo de Cobrança</h3>
    <pre id="receiptContent"></pre>
    <button id="shareButton" onclick="shareReceipt()" class="primary">Compartilhar via WhatsApp</button>
  </div>
</div>

<!-- Modal para relatório -->
<div id="reportModal" class="modal">
  <div class="modal-content modal-maxwidth">
    <span class="close" onclick="closeReportModal()">&times;</span>
    <h3>Relatório Geral</h3>
    <div id="reportFilters" class="mb-10"></div>
    <div id="reportContent" class="report-content-scroll"></div>
    <button class="primary" onclick="exportReport('csv')">Exportar CSV</button>
    <button class="secondary" onclick="exportReport('json')">Exportar JSON</button>
  </div>
</div>

<!-- Scripts externos divididos -->
<script type="module" src="auth.js"></script>
<script src="clients.js"></script>
<script src="loans.js"></script>
<script src="dashboard.js"></script>
<script src="reports.js"></script>

</body>
</html>